---
title: "Survey 2"
author: "Statenfreude"
format: html
echo: false
execute: 
  warning: false
  messages: false
---

```{r intial setup}
rm(list=ls())
library(tidyverse); library(kableExtra)
base_theme <- theme_minimal() +
  theme(
    axis.text=element_text(size=12),
    axis.title=element_text(size=13),
    plot.title=element_text(size=15),
    plot.title.position="plot",
    plot.caption.position="plot"
  )
theme_set(base_theme)
df_proc <- read_rds("df_proc.rds")
df_wide <- read_rds("wide-data.rds")
```

## Questions
We decided to select questions 1 & 2 from our survey.

**Question 1:** Please rank the following stores in order of your preference 
(1-4) for a new store in Laramie.

**Question 2:** Please rank the following characteristics of each store: price,
quality, and variety.

## A priori hypotheses
The survey questions generated a number of hypotheses. We explored the 3 listed here.

1) For question 1, we expected Target and Costco to be rated the highest out of the four options.
2) There was an alternate hypothesis that Trader Joe's and Whole Foods might be more popular with students given that students are probably most interested in food options rather than general shopping.
3) Target has been experiencing push back on DEI business decisions and that may affect its ranking.
4) For question 2, we expected that the mean (combined price, quality, and variety scores) of overall approval of Whole Foods will be higher for individuals who rated Target higher than Costco in question 1.This is based on the impression that ranking Target above Costco implies cost may be less important to ranking, which would diminish one of the most salient cons of Whole Foods (price).

We did not capture demographic data, but nearly all of our sampling was
conducted in the student union, so most of the survey respondents are very
likely to be students at the university.

## Results question 1

### Hypotheses 1-3
The mean rankings and other descriptive statistics are listed in the table
below. The highest ranked store was Target, followed by Costco. This
is counter to the second hypothesis about store rankings but may support the
first. Target did rank the highest in the survey, which runs counter to the
hypothesis that Target is perceived in a negative light. However, the survey was
not designed to explore this question, so no firm conclusions can be drawn from 
this result.

```{r question 1 results}
# question one 
df_proc |>
  filter(question == 1) |> 
  group_by(brand) |> 
  summarise(
    avg = mean(response, na.rm=TRUE),
    stderr = sd(response, na.rm=TRUE),
    min = min(response, na.rm=TRUE),
    max = max(response, na.rm=TRUE),
    md = median(response, na.rm=TRUE)
  ) |> kable(
    caption="Descriptive statistics for store rankings.",
    digits = c(0,1,2,0,0,1),
    col.names=c("Store", "Avg", "Std dev", "Min", "Max", "Median")
  )
```

```{r question 1 box plot}
df_proc |>
  filter(question == 1 & !is.na(response)) |> 
  ggplot(aes(x=brand, y=response, colour=brand)) +
  geom_boxplot() +
  geom_jitter(alpha=0.5, height=0.1, width=0.4) +
  scale_colour_brewer(palette="Dark2") +
  scale_y_reverse() +
  labs(
    y="Response",
    x="Store",
    colour="Store",
    title="Comparison of store rankings",
    subtitle="Lower scores indicate a higher preference",
    caption="Data points have been jittered both vertically and 
             horizontally to prevent overplotting."
  )
```

```{r question 1 preference means}
df_pref_tgt <- df_wide |> filter(target_1 > costco_1)

wf_mean_tgt <- df_proc |> filter(question==2 & brand=="Whole Foods" & !is.na(response)) |> 
  select(respondent, response) |> 
  group_by(respondent) |> 
  summarise(
    agg_response = mean(response)
  ) |> inner_join(df_pref_tgt, by="respondent") |> 
  select(respondent, agg_response) |> 
  summarise(
    wf_pref_avg = mean(agg_response)
  ) |> pull() |> round(2)

wf_mean_not_tgt <- df_proc |> filter(question==2 & brand=="Whole Foods" & !is.na(response)) |> 
  select(respondent, response) |> 
  group_by(respondent) |> 
  summarise(
    agg_response = mean(response)
  ) |> anti_join(df_pref_tgt, by="respondent") |> 
  select(respondent, agg_response) |> 
  summarise(
    wf_pref_avg = mean(agg_response)
  ) |> pull() |> round(2)
```

### Hypothesis 4
For respondents who rank Target above Costco, the aggregate rating score is 
`r wf_mean_tgt`. The aggregate rating score for respondents who rank Costco
above Target is `r wf_mean_not_tgt`. This result is counter to what was
initially hypothesised.

## Question 2
The second survey question asks respondents to rate each store on 3
characteristics: price, quality, and variety. Each characteristic is measured on
a multiple rating scale from 1 (poor) to 5 (excellent). The average
characteristic score for each store is presented in the heat map below.
```{r question 2 visualisations}
#| fig-cap: "Heatmap of store characterics. Darker colours indicate higher rankings."
df_proc |>
  filter(question == 2 & !is.na(response)) |> 
  group_by(brand, category) |> 
  summarise(
    avg = mean(response) |> round(2),
    stderr = sd(response) |> round(2),
    min = min(response) |> round(2),
    max = max(response) |> round(2)
  ) |> ggplot(aes(brand, category, fill= avg)) + 
  geom_tile(colour="white") +
  geom_text(aes(label=avg), color="white") +
  scale_fill_viridis_b(direction=-1) +
  coord_flip() +
  labs(
    x="Store",
    y="Characteristic",
    fill="Avg Score"
  )
```
Costco rates the highest of the 4 stores across each characteristic. Costco was
noted ranked the highest in question 1, so it is interesting that it is rated
highest in both price and variety and equivalent to Whole Foods and Trader Joe's
on quality. This could be a situation where respondents are not consistently
applying transitivity of rankings. A future survey design would need to take
this into account.

## Challenges

